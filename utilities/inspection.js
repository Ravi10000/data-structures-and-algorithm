const inspection = {
    "surveyor": {
        "userId": {
            "_id": "664b0c324c770376074bf577",
            "email": "abhishek@gmail.com",
            "password": "$2b$10$sJ6OCJpX147BbrKUwQYaoeTA3Pta3bOzlNnIn1TjKe8T1luUsxMt2",
            "usertype": "client",
            "profilepic": "1716194353388-Ellipse 554.png",
            "fname": "Abhishek",
            "lname": "kumar",
            "username": "kumar",
            "userRole": "Operational",
            "cpf": "ertet",
            "dob": "2024-05-21",
            "gender": "Male",
            "cep": "undefined",
            "state": "",
            "city": "",
            "pincode": "205001",
            "status": "active",
            "neighbourhood": "fghfhf",
            "complement": "hfhfh",
            "street": "hfhfh",
            "contacts": [
                "4654646464"
            ],
            "emails": [
                "abhishek@gmail.com"
            ],
            "isPrimary": false,
            "isVerified": true,
            "entityId": "34ade5d6-c6cb-4b6b-9b76-acd74a2fa320",
            "createdAt": "2024-05-20T08:39:14.276Z",
            "updatedAt": "2024-07-09T04:47:02.514Z",
            "__v": 0,
            "token": "egZ7ecjtRqWqADdoiRiNje:APA91bGrELfDUby3stbGLMzBm0V7KzQ3n7NnSQ1kY-yUJdadLn5IWeABrQqsRVQ25pMAuNE5_EcJwEiLRPR48MPU4PgCM2RBw3UmgvAd5T5dT5xQeUy0qjgzSVmLQIlAVhx6EAgjrZ1X"
        },
        "surveyordate": "2024-07-25",
        "surveyorcomments": "test"
    },
    "accessinformation": {
        "removalkeysother": {
            "houseno1": "123",
            "street1": "test",
            "pincode1": "201301",
            "city1": "Gautam Buddha Nagar",
            "state1": "Uttar Pradesh"
        },
        "returnkeysother": {
            "houseno2": "123",
            "street2": "test",
            "pincode2": "201301",
            "city2": "Gautam Buddha Nagar",
            "state2": "Uttar Pradesh"
        },
        "removalkeys": "Other",
        "returnkeys": "Other",
        "comment1": "test"
    },
    "accompanyinspection": {
        "going": "Sim",
        "name": "womb",
        "date": "2024-07-12",
        "contact": "34567890",
        "time": "16:33",
        "email1": "test@gmail.com",
        "comment2": "test"
    },
    "_id": "6687dc2bdcb49edc25e213cd",
    "type": "check-out",
    "propertyId": {
        "_id": "6687cfa5dcb49edc25e1ac5e",
        "uniqueId": "test-property",
        "type": {
            "_id": "65efedbfdb5f62aabe7d31a0",
            "name": "APARTMENT",
            "status": "active",
            "createdAt": "2024-03-12T05:53:03.565Z",
            "updatedAt": "2024-03-12T05:53:03.565Z",
            "__v": 0
        },
        "purpose": {
            "_id": "65efee12db5f62aabe7d31ac",
            "name": "RESIDENCIAL",
            "status": "active",
            "createdAt": "2024-03-12T05:54:26.826Z",
            "updatedAt": "2024-03-12T05:54:26.826Z",
            "__v": 0
        },
        "area": "100",
        "furnished": "SEMI FURNISHED",
        "rooms": 2,
        "pincode": "201301",
        "city": "Gautam Buddha Nagar",
        "street": "123",
        "state": "Uttar Pradesh",
        "neighborhood": "atlas",
        "complement": "123",
        "roadno": "223a",
        "entityId": "34ade5d6-c6cb-4b6b-9b76-acd74a2fa320",
        "createdAt": "2024-07-05T10:49:09.094Z",
        "updatedAt": "2024-07-05T10:49:09.094Z",
        "__v": 0
    },
    "companyId": {
        "_id": "661f8aa6b7fabee1dcc6b01b",
        "companytype": "Individual",
        "name": "Sam",
        "branch": "Branch",
        "cpf": "ww",
        "contacts": [
            " reesd"
        ],
        "emails": [
            " d3eed"
        ],
        "entityId": "34ade5d6-c6cb-4b6b-9b76-acd74a2fa320",
        "houseno": "2123w",
        "street": "dde",
        "pincode": "xxdd",
        "city": "undefined",
        "state": "undefined",
        "complement": "rww",
        "neighborhood": "fre",
        "website": "edw",
        "logo": "1713343141405-shop-01.png",
        "comment": "<p>undefined</p>",
        "createdAt": "2024-04-17T08:39:02.603Z",
        "updatedAt": "2024-07-09T04:27:37.598Z",
        "__v": 0,
        "comment1": "undefined"
    },
    "clientId": {
        "_id": "6687cffedcb49edc25e1b0e8",
        "typeofclient": "individual",
        "name": "test",
        "surname": "test",
        "phone1": "1234567890",
        "phone2": "1234567890",
        "email": "test@gmail.com",
        "cpf": "123-4456-78",
        "material": "UnMarried",
        "clientbehaviour": "Good",
        "type": "option1",
        "nationality": "option1",
        "profession": "test",
        "pincode": 201301,
        "city": "Gautam Buddha Nagar",
        "street": "23",
        "state": "Uttar Pradesh",
        "neighborhood": "",
        "complement": "123",
        "roadno": "22a",
        "comment": "test",
        "entityId": "34ade5d6-c6cb-4b6b-9b76-acd74a2fa320",
        "createdAt": "2024-07-05T10:50:38.265Z",
        "updatedAt": "2024-07-05T10:50:38.265Z",
        "__v": 0
    },
    "approvalstatus": "Approved",
    "uniqueId": "INV0109",
    "isdelete": false,
    "acceptCredit": true,
    "status": "Finalized",
    "comment": "test",
    "attachment": "1720177148477-soft-drink.png",
    "people": [
        {
            "clientId": {
                "_id": "6687cffedcb49edc25e1b0e8",
                "typeofclient": "individual",
                "name": "test",
                "surname": "test",
                "phone1": "1234567890",
                "phone2": "1234567890",
                "email": "test@gmail.com",
                "cpf": "123-4456-78",
                "material": "UnMarried",
                "clientbehaviour": "Good",
                "type": "option1",
                "nationality": "option1",
                "profession": "test",
                "pincode": 201301,
                "city": "Gautam Buddha Nagar",
                "street": "23",
                "state": "Uttar Pradesh",
                "neighborhood": "",
                "complement": "123",
                "roadno": "22a",
                "comment": "test",
                "entityId": "34ade5d6-c6cb-4b6b-9b76-acd74a2fa320",
                "createdAt": "2024-07-05T10:50:38.265Z",
                "updatedAt": "2024-07-05T10:50:38.265Z",
                "__v": 0
            },
            "role": "Lessee",
            "addToReport": true,
            "_id": "6687d204dcb49edc25e1e7dc"
        }
    ],
    "basicinformation": [
        {
            "metertype": "Fascade",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448303_file_1720177537480_file_CAP3310265637246654395.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c0"
        },
        {
            "metertype": "Keys",
            "description": "test",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448311_file_1720177537462_file_CAP6025674215230130603.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448329_file_1720177537454_file_CAP9188034512199024714.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448314_file_1720177537464_file_CAP5869340114286851539.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448318_file_1720177537441_file_CAP3606565634439932467.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c1"
        },
        {
            "metertype": "Electricity",
            "reading1": "test",
            "reading2": "test",
            "description": "test",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448340_file_1720177537476_file_CAP3224725553234237298.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448334_file_1720177537450_file_CAP799562685728370614.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448322_file_1720177537514_file_CAP5722729856802930819.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448334_file_1720177537460_file_CAP7500116518296762618.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c2"
        },
        {
            "metertype": "Water",
            "reading1": "gesg",
            "reading2": "test",
            "description": "test",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448349_file_1720177537488_file_CAP17884513624020454.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448360_file_1720177537487_file_CAP7763705018022913806.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448405_file_1720177537487_file_CAP8906948674412280068.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c3"
        },
        {
            "metertype": "Gas",
            "reading1": "gest",
            "reading2": "tedt",
            "description": "tezt",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448358_file_1720177537514_file_CAP5960083182459228099.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448337_file_1720177537484_file_CAP9126626506684935847.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448365_file_1720177537513_file_CAP5804877646879402499.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c4"
        },
        {
            "metertype": "LetterBox",
            "description": "test\n\n\n\n\n",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448371_file_1720177537475_file_CAP6669658136681110835.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448366_file_1720177537500_file_CAP7607338672181643325.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c5"
        },
        {
            "metertype": "Garage",
            "description": "tezt\n\n",
            "basic_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448391_file_1720177537504_file_CAP7138945387032137049.jpg"
            ],
            "_id": "6687d382dcb49edc25e1f9c6"
        }
    ],
    "dependencies": [
        {
            "name": "terrCe 1",
            "dependencies_photos": [
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448373_file_1720179025236_file_CAP7056320239521925719.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448430_file_1720179025223_file_CAP392617406782197804.jpg",
                "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448400_file_1720179025209_file_CAP568917647821143841.jpg"
            ],
            "nonconformities": [
                {
                    "dependencies_conformities_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448392_file_1720179025222_file_CAP453555897945851774.jpg"
                    ],
                    "description": "tedt\n\n",
                    "resolved": false,
                    "checkout": false,
                    "_id": "6687dee2dcb49edc25e238b1",
                    "type": "Owner Responsible"
                },
                {
                    "dependencies_conformities_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448430_file_1720179025241_file_CAP5458355199850862304.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448433_file_1720179025219_file_CAP4556414716874792833.jpg"
                    ],
                    "description": "tezt",
                    "resolved": false,
                    "checkout": false,
                    "_id": "6687dee2dcb49edc25e238b2",
                    "type": "Renter Responsible"
                }
            ],
            "areas": [
                {
                    "name": "floor 1",
                    "condition": "New",
                    "description": "tedt\n",
                    "areas_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448418_file_1720179025249_file_CAP6287607745836247057.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448422_file_1720179025227_file_CAP1325197098991505867.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448426_file_1720179025250_file_CAP5352435030449344279.jpg"
                    ],
                    "characteristics": [
                        {
                            "name": "Tiles",
                            "value": "Blue",
                            "_id": "6687dee2dcb49edc25e238b4"
                        }
                    ],
                    "nonconformities": [
                        {
                            "areas_conformities_photos": [],
                            "description": "test\n",
                            "resolved": false,
                            "checkout": false,
                            "_id": "6687dee2dcb49edc25e238b5"
                        }
                    ],
                    "_id": "6687dee2dcb49edc25e238b3"
                },
                {
                    "name": "wall 1",
                    "condition": "Regular",
                    "description": "wall test\n",
                    "areas_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448437_file_1720179025272_file_CAP7511132998991507107.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448466_file_1720179025296_file_CAP665341072696402412.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448440_file_1720179025271_file_CAP8072809538018687593.jpg"
                    ],
                    "nonconformities": [
                        {
                            "areas_conformities_photos": [],
                            "description": "damage\n",
                            "resolved": false,
                            "checkout": false,
                            "_id": "6687dee2dcb49edc25e238b7"
                        }
                    ],
                    "_id": "6687dee2dcb49edc25e238b6",
                    "characteristics": []
                },
                {
                    "name": "wall 2",
                    "condition": "Good",
                    "description": "wall 2\n",
                    "areas_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448443_file_1720179025245_file_CAP1445740671339655179.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448447_file_1720179025280_file_CAP4270284426937040813.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448451_file_1720179025309_file_CAP6647771898704154758.jpg"
                    ],
                    "nonconformities": [
                        {
                            "areas_conformities_photos": [],
                            "description": "test",
                            "resolved": false,
                            "checkout": false,
                            "_id": "6687dee2dcb49edc25e238b9"
                        }
                    ],
                    "_id": "6687dee2dcb49edc25e238b8",
                    "characteristics": []
                },
                {
                    "name": "wall 3",
                    "areas_photos": [],
                    "_id": "6687dee2dcb49edc25e238ba",
                    "characteristics": [],
                    "nonconformities": []
                },
                {
                    "name": "wall 4",
                    "condition": "Good",
                    "areas_photos": [],
                    "nonconformities": [
                        {
                            "areas_conformities_photos": [],
                            "description": "test",
                            "resolved": false,
                            "checkout": false,
                            "_id": "6687dee2dcb49edc25e238bc"
                        }
                    ],
                    "_id": "6687dee2dcb49edc25e238bb",
                    "characteristics": []
                }
            ],
            "_id": "6687dee2dcb49edc25e238b0"
        },
        {
            "name": "kitchen 1",
            "dependencies_photos": [],
            "areas": [
                {
                    "name": "test 1",
                    "condition": "Good",
                    "description": "test",
                    "areas_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448481_file_1720179025318_file_CAP822661191828860022.jpg",
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448458_file_1720179025287_file_CAP5804707104429755373.jpg"
                    ],
                    "nonconformities": [
                        {
                            "areas_conformities_photos": [],
                            "description": "resr",
                            "resolved": false,
                            "checkout": false,
                            "_id": "6687dee2dcb49edc25e238bf",
                            "type": "Renter Responisible"
                        }
                    ],
                    "_id": "6687dee2dcb49edc25e238be",
                    "characteristics": []
                },
                {
                    "name": "test 2",
                    "condition": "Good",
                    "description": "resr",
                    "areas_photos": [
                        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448458_file_1720179025315_file_CAP595788788415490934.jpg"
                    ],
                    "nonconformities": [
                        {
                            "areas_conformities_photos": [],
                            "description": "resr",
                            "resolved": false,
                            "checkout": false,
                            "_id": "6687dee2dcb49edc25e238c1"
                        }
                    ],
                    "_id": "6687dee2dcb49edc25e238c0",
                    "characteristics": []
                }
            ],
            "_id": "6687dee2dcb49edc25e238bd",
            "nonconformities": []
        },
        {
            "name": "kitchen 2",
            "dependencies_photos": [],
            "_id": "6687dee2dcb49edc25e238c2",
            "nonconformities": [],
            "areas": []
        },
        {
            "name": "bed 1",
            "dependencies_photos": [],
            "_id": "6687dee2dcb49edc25e238c3",
            "nonconformities": [],
            "areas": []
        },
        {
            "name": "bed 2",
            "dependencies_photos": [],
            "_id": "6687dee2dcb49edc25e238c4",
            "nonconformities": [],
            "areas": []
        },
        {
            "name": "bed 3",
            "dependencies_photos": [],
            "_id": "6687dee2dcb49edc25e238c5",
            "nonconformities": [],
            "areas": []
        }
    ],
    "dependencydescription": "test\n",
    "dependencyphotos": [
        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448408_file_1720179025214_file_CAP7718634632372406663.jpg",
        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448386_file_1720179026203_file_CAP7097334403624889939.jpg",
        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448378_file_1720179026195_file_CAP3911258627567193429.jpg",
        "https://fabiobucketimages.s3.eu-north-1.amazonaws.com/1720180448421_file_CAP8685089429747970139.jpg"
    ],
    "entityId": "34ade5d6-c6cb-4b6b-9b76-acd74a2fa320",
    "createdAt": "2024-07-05T11:42:35.542Z",
    "updatedAt": "2024-07-05T11:54:10.227Z",
    "__v": 0
}

console.log(inspection);
const onlyConformities = true;
const userType = "owner";

function isUser(nc){
    return nc?.type?.toLowerCase?.()?.includes?.(userType);
}
function filterDependency(inspection, onlyConformities, userType){
    if (onlyConformities) {
      const filteredDependencies = [];
      console.log({ testDependencies: inspection.dependencies });
      inspection?.dependencies?.forEach((dependency) => {
        if (userType) {
          const ncList = [];
          for (let nc of dependency.nonconformities) {
            if (isUser(nc)) {
              ncList.push(nc)
            }
          }
          const areas = [];
          for (let area of dependency.areas) {
            let innerNCList = [];
            for (let nc of area.nonconformities) {
              if (isUser(nc)) {
                innerNCList.push(nc)
              }
            }
            if (innerNCList.length) {
              area.nonconformities = innerNCList;
              console.log({innerNCList});
              areas.push(area);
            }
          }
          if (ncList.length || areas.length) {
              console.log({ncList});
            console.log({areas});
            dependency.areas = areas;
            dependency.nonconformities = ncList;
              console.log({dependency});
            filteredDependencies.push({dependency});
              console.log({filteredDependencies})
          }
        } else {
          if (dependency.nonconformities?.length > 0)
            filteredDependencies.push(dependency);
          const areas = [];
          for (let area of dependency?.areas) {
            if (area?.nonconformities?.length > 0) {
              areas.push(area);
              // filteredDependency.push(dependency);
            }
          }
          if (areas?.length) {
            filteredDependencies.push(dependency);
          }
        }
      })
      return filteredDependencies;
    } else {
      return JSON.parse(JSON.stringify(inspection.dependencies));
    }
  }


console.log(filterDependency(inspection))